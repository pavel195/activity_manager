# Техническое задание для распределённого приложения мониторинга (аналог ELK с Telegram-уведомлениями)

## 1. Общая концепция

Система состоит из двух основных компонентов:

- **Агент (клиентская часть)** – устанавливается на ПК пользователей под управлением Windows. Отслеживает запуск определённых программ и передаёт данные о событиях на сервер.
- **Сервер (централизованная часть)** – принимает данные от агентов, сохраняет их в базе данных PostgreSQL и в Elasticsearch (для последующего анализа, как в ELK-стеке), а также отправляет уведомления в Telegram через бота.

---

## 2. Функциональные требования

### 2.1. Агент (клиентская часть)

- **Мониторинг процессов:**
  - Отслеживание запуска программ: **Chrome, Yandex, Telegram, Проводник**.
  - Сбор информации о событии: время события, имя пользователя, имя процесса.
  - Исключение системных процессов.
  
- **Передача данных:**
  - Отправка данных о событиях на сервер через HTTP (REST API) или другой выбранный протокол.
  - Данные передаются в формате JSON.

- **Конфигурация:**
  - Настраиваемый внешний конфигурационный файл для указания списка отслеживаемых процессов, параметров подключения к серверу и интервалов опроса.

### 2.2. Сервер (централизованная часть)

- **Прием и обработка данных:**
  - Реализация REST API для приёма данных от агентов.
  - Аутентификация агентов (с использованием API-ключей или токенов) и обеспечение безопасности передачи (например, через HTTPS).

- **Сохранение данных:**
  - Запись событий в базу данных PostgreSQL. Рекомендуемая структура таблицы:
    - **id** – уникальный идентификатор.
    - **timestamp** – время события.
    - **username** – имя пользователя.
    - **process_name** – имя запущенного процесса.
    - **agent_id** – идентификатор агента.
  - Индексация и хранение данных в Elasticsearch для дальнейшего анализа.

- **Логирование и визуализация:**
  - Ведение логов работы сервера, включая ошибки и сбои, в отдельном лог-файле.
  - Возможность интеграции с Kibana для визуализации данных, хранящихся в Elasticsearch.

- **Уведомления в Telegram:**
  - Интеграция с Telegram через Telegram-бота.
  - Формат уведомления:  
    `"[Время] Пользователь [Имя пользователя] запустил [Имя процесса]"`
  - Гибкая настройка фильтров для исключения системных процессов или других нежелательных событий.

---

## 3. Технические требования

### 3.1. Технологии и библиотеки

- **Язык программирования:** Python

- **Агент:**
  - **Мониторинг Windows:** `pywin32` или `win32evtlog`
  - **Отслеживание процессов:** `psutil`
  - **HTTP-запросы:** `requests` или аналогичная библиотека

- **Сервер:**
  - **REST API:** FastAPI или Django
  - **Работа с PostgreSQL:** `sqlalchemy` или `psycopg2`
  - **Работа с Elasticsearch:** `elasticsearch` или `elastic-transport`
  - **Уведомления в Telegram:** 

### 3.2. Архитектура и коммуникация

- **Агент-сервер:**
  - Агент собирает данные о запущенных процессах и отправляет их в формате JSON на сервер.
  - Сервер принимает данные, сохраняет их в PostgreSQL и индексирует в Elasticsearch.
  - После успешной записи данных сервер инициирует отправку уведомления в Telegram через настроенного бота.

- **Безопасность:**
  - Использование протокола HTTPS для защиты данных при передаче.
  - Аутентификация агентов на сервере с использованием API-ключей или токенов.

### 3.3. Производительность и масштабируемость

- Оптимизация работы агента для минимизации нагрузки на ПК.
- Асинхронная обработка запросов на сервере для обеспечения высокой пропускной способности.
- Возможность подключения нескольких агентов к единому серверу для централизованного мониторинга.

---

## 4. Дополнительные требования

- **Конфигурация и настройка:**
  - Возможность изменения списка отслеживаемых процессов и параметров подключения через внешний конфигурационный файл.
  - Гибкая настройка параметров для базы данных, Elasticsearch и Telegram-бота.

- **Логирование:**
  - Ведение логов на стороне агента и сервера с подробной информацией о всех событиях, ошибках и сбоях.

- **Интеграция с ELK-стеком:**
  - Хранение и индексация данных в Elasticsearch для последующего анализа и визуализации через Kibana или аналогичные инструменты.

- **Уведомления:**
  - Возможность настройки фильтров для уведомлений, чтобы исключать системные процессы и настраивать пороговые значения для отправки уведомлений.

---

## 5. Итоговая схема работы системы

1. **Сбор данных:**
   - Агент на ПК пользователя отслеживает запуск программ (Chrome, Yandex, Telegram, Проводник), собирает информацию (время, имя пользователя, имя процесса) и исключает системные процессы.

2. **Передача данных:**
   - Собранные данные отправляются на сервер через защищённое соединение (HTTPS) в формате JSON.

3. **Обработка на сервере:**
   - Сервер принимает данные, проводит аутентификацию агента, сохраняет данные в PostgreSQL и индексирует их в Elasticsearch.
   - После обработки данных сервер инициирует отправку уведомления в Telegram через Telegram-бота.

4. **Анализ и визуализация:**
   - Сохранённые данные доступны для анализа и визуализации через Kibana или другие инструменты, интегрированные с Elasticsearch.

---

Данное техническое задание описывает систему, работающую по принципу ELK-стека с интеграцией уведомлений в Telegram. Это позволяет централизованно собирать, анализировать и оповещать о событиях на ПК пользователей.
